CREATE PROCEDURE [dbo].[sp_{{nametable}}_search] (
		          @page_index   INT,   @page_size  INT,  {{store.parameter_1}})
AS
    BEGIN 
        DECLARE @RecordCount BIGINT;
        IF(@page_size <> 0)
            BEGIN
                IF(@lang = 'e')
                    BEGIN
                        SET NOCOUNT ON;
                        SELECT {{store.tablefield}},{{store.lang_e}}
                        INTO #Results1
                        FROM {{nametable}}
                        WHERE  {{store.checking}} AND {{store.lang_e_check}} 
                        {{store.order}}
                        SELECT @RecordCount = COUNT(*)
                        FROM #Results1;
                        SELECT *, 
                               @RecordCount AS RecordCount
                        FROM #Results1
                        WHERE ROWNUMBER BETWEEN(@page_index - 1) * @page_size + 1 AND(((@page_index - 1) * @page_size + 1) + @page_size) - 1
                              OR @page_index = -1;
                        DROP TABLE #Results1;
                END;
                    ELSE
                    BEGIN
                        SET NOCOUNT ON;
                        SELECT {{store.tablefield}}, {{store.lang_v}}
                        INTO #Results2
                        FROM  {{nametable}}
                        WHERE  {{store.checking}} AND {{store.lang_v_check}} 
                        SELECT @RecordCount = COUNT(*)
                        FROM #Results2;
                        SELECT *, 
                               @RecordCount AS RecordCount
                        FROM #Results2
                        WHERE ROWNUMBER BETWEEN(@page_index - 1) * @page_size + 1 AND(((@page_index - 1) * @page_size + 1) + @page_size) - 1
                              OR @page_index = -1;
                        DROP TABLE #Results2;
                END;
        END;
            ELSE
            BEGIN
                IF(@lang = 'e')
                    BEGIN
                        SET NOCOUNT ON;
                        SELECT {{store.tablefield}},{{store.lang_e}}
                        INTO #Results3
                        FROM {{nametable}}
                        WHERE  {{store.checking}} AND {{store.lang_e_check}} 
                        {{store.order}}
                        SELECT @RecordCount = COUNT(*)
                        FROM #Results3;
                        SELECT *, 
                               @RecordCount AS RecordCount
                        FROM #Results3;
                        DROP TABLE #Results3;
                END;
                    ELSE
                    BEGIN
                        SET NOCOUNT ON;
                     SELECT {{store.tablefield}}, {{store.lang_v}}
                        INTO #Results4
                        FROM  {{nametable}}
                        WHERE  {{store.checking}} AND {{store.lang_v_check}} 
                        SELECT @RecordCount = COUNT(*)
                        FROM #Results4;
                        SELECT *, 
                               @RecordCount AS RecordCount
                        FROM #Results4;
                        DROP TABLE #Results4;
                END;
        END;
    END;
GO

